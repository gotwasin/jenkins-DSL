import jenkins.*
import jenkins.model.*
import hudson.*
import hudson.model.*

jenkins = Jenkins.instance

def String[] allJobs = jenkins.getAllItems(Job.class).fullName

def targetJobs = [
  'channel-api/mobile-applications/',
  'channel-api/mobile-audit/',
  'channel-api/mobile-auth/',
  'channel-api/mobile-campaign/',
  'channel-api/mobile-cardless/'
]

def targetFolder = DEV/Java-backend
	
println "Working at ${targetFolder}"
  
def existingJobs = allJobs.findAll { job -> job.contains(targetFolder) }

targetJobs.each { job ->

  if(!existingJobs.any { existingJob -> existingJob.contains(job) } ) {
    def mainFolder = job.split('/')[0]
    def Jobname = job.split('/')[-1]
    def template = jenkins.getItemByFullName("next/Java-backend/channel-api/mobile-audit")
    def targetPath = jenkins.getItemByFullName("${targetFolder}/${mainFolder}/${Jobname}")
    try {
      jenkins.copy(template, targetPath)
      println "Created ${targetFolder}/${job}"
      } 
    } catch (Exception err) {
      def temp = jenkins.getItemByFullName(targetPath)
      println err.message
      Items.delete(targetPath)
    }
  }
}
